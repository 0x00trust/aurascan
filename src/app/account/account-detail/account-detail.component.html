<app-pagetitle title="ACCOUNT DETAIL" [breadcrumbItems]="breadCrumbItems"></app-pagetitle>
<div class="account-detail-content card">
  <div class="row card-header bg-transparent border-bottom fw-bold">
    <div class="col-3">
      <div class="box-account">
        <div class="box-qr">
          <canvas id="canvas" #canvas></canvas>
        </div>
        <div>
          Address
          <span class="account-info-copied">
            <p class="txt-copied" [ngClass]="isCopy ? 'show-copy' : ''">copied!</p>
          </span>
        </div>
        <p class="address-account cursor-pointer mt-2" (click)="copyMessage(id)">{{ id }}</p>
        <div class="box-total">
          <p>Total Value</p>
          <p>${{ tokenPrice * item?.total | number: '1.2-2' }}</p>
        </div>
      </div>
    </div>
    <div class="col-9">
      <div class="box-assets">
        <span class="title-assets">Assets</span>
        <div class="account-list-search-area">
          <input
            placeholder="Search Asset"
            class="account-list-search-input"
            [(ngModel)]="textSearch"
            (ngModelChange)="searchToken()"
          />
          <span class="txt-asset fw-normal">Asset Type</span>
          <mat-select class="list-token" (selectionChange)="searchToken()" [(value)]="selected">
            <mat-option *ngFor="let item of assetsType" [value]="item.label">
              {{ item.value | translate }}
            </mat-option>
          </mat-select>
        </div>
      </div>
      <ng-container *ngIf="!searchNullData; else noValues">
        <app-account-table *ngIf="dataSourceToken"
        [dataSource]="dataSourceToken"
        [templates]="templatesToken"
        [displayedColumns]="displayedColumnsToken"
        [pageData]="pageDataToken"
        [pageEventType]="pageEventType.Token"
        (pageEvent)="changePage($event)"
        [textNull]="'NO COINS'"
      >
      </app-account-table>
      </ng-container>
      <ng-template #noValues>
        <app-table-no-data></app-table-no-data>
      </ng-template>
    </div>
  </div>
  <div class="card-body row">
    <div class="col-9">
      <mat-tab-group>
        <mat-tab label="Delegations">
          <app-account-table
            [dataSource]="dataSourceDelegation"
            [templates]="templatesDelegation"
            [displayedColumns]="displayedColumnsDelegation"
            [pageData]="pageDataDelegation"
            [pageEventType]="pageEventType.Delegation"
            (pageEvent)="changePage($event)"
          >
          </app-account-table>
        </mat-tab>
        <mat-tab label="Unbondings">
          <app-account-table
            [dataSource]="dataSourceUnBonding"
            [templates]="templatesUnBonding"
            [displayedColumns]="displayedColumnsUnBonding"
            [pageData]="pageDataUnbonding"
            [pageEventType]="pageEventType.Unbonding"
            (pageEvent)="changePage($event)"
          ></app-account-table>
        </mat-tab>
        <mat-tab label="Redelegations">
          <app-account-table
            [dataSource]="dataSourceReDelegation"
            [templates]="templatesReDelegation"
            [displayedColumns]="displayedColumnsReDelegation"
            [pageData]="pageDataRedelegation"
            [pageEventType]="pageEventType.Redelegation"
            (pageEvent)="changePage($event)"
          ></app-account-table>
        </mat-tab>
        <mat-tab label="Vestings">
          <app-account-table
            [dataSource]="dataSourceVesting"
            [templates]="templatesVesting"
            [displayedColumns]="displayedColumnsVesting"
            [pageData]="pageDataVesting"
            [pageEventType]="pageEventType.Vestings"
            (pageEvent)="changePage($event)"
          ></app-account-table>
        </mat-tab>
      </mat-tab-group>
    </div>
    <div class="col-3">
      <div id="walletChart">
        <ng-container *ngIf="item?.total > 0; else chartNoValue">
          <apx-chart
            [series]="chartOptions.series"
            [chart]="chartOptions.chart"
            [labels]="chartOptions.labels"
            [fill]="chartOptions.fill"
            [dataLabels]="chartOptions.dataLabels"
            [responsive]="chartOptions.responsive"
            [plotOptions]="chartOptions.plotOptions"
            [legend]="chartOptions.legend"
            [colors]="chartOptions.colors"
          >
          </apx-chart>
        </ng-container>
        <ng-template #chartNoValue>
          <div class="d-flex flex-column justify-content-center align-items-center">
            <div class="box-chart">
              <div></div>
            </div>
          </div>
        </ng-template>
      </div>
      <div class="box-balance">
        <span class="balance-name g-purple">{{ global.stableToken }}</span>
        <span class="balance-amount">{{ item?.total | number: global.formatNumberToken }}</span>
      </div>
      <ng-container *ngFor="let item of chartCustomOptions">
        <div class="d-flex justify-content-between">
          <div class="d-flex">
            <div class="item-color-balance" [ngStyle]="{ 'background-color': item.color }"></div>
            <span>{{ item.name }}</span>
          </div>
          <span>{{ item.amount | number: global.formatNumberToken }}</span>
        </div>
      </ng-container>
    </div>
  </div>

  <div class="col-12">
    <div class="card">
      <div class="card-header align-items-center d-flex">
        <p class="card-title mb-0 flex-grow-1">Transactions</p>
      </div>
      <div class="card-body px-0">
        <ngx-simplebar style="max-height: 400px">
          <ng-container *ngIf="length > 0; else noValues">
            <table mat-table [dataSource]="dataSource" class="table-reponsive">
              <ng-container *ngFor="let template of templates; index as i">
                <ng-container [matColumnDef]="template.matColumnDef">
                  <th mat-header-cell *matHeaderCellDef>
                    <div [innerHTML]="template.headerCellDef | translate"></div>
                  </th>

                  <td mat-cell *matCellDef="let data">
                    <div>
                      <ng-container [ngSwitch]="template.matColumnDef">
                        <div *ngSwitchCase="'timestamp'">
                          <img src="/assets/images/icons/time.png" height="20" class="m-1 mb-0 mt-0" />
                          {{ data[template.matColumnDef] | calDate }} ago
                        </div>
                        <div *ngSwitchCase="'tx_hash_format'" class="g-blue cursor-pointer hash-link">
                          {{ data[template.matColumnDef] }}
                        </div>
                        <div *ngSwitchCase="'height'" class="g-blue cursor-pointer block-link">
                          {{ data[template.matColumnDef] }}
                        </div>
                        <div *ngSwitchCase="'type'" class="g-type">
                          {{ data[template.matColumnDef] }}
                        </div>
                        <div *ngSwitchCase="'status'">
                          <img
                            [src]="
                              data[template.matColumnDef] === statusTransaction.Success
                                ? 'assets/images/icons/success.svg'
                                : 'assets/images/icons/fail.svg'
                            "
                            alt=""
                          />
                          {{ data[template.matColumnDef] }}
                        </div>
                        <div *ngSwitchCase="'fee'">
                          {{ data[template.matColumnDef] }} <span class="g-purple">{{ global.stableToken }}</span>
                        </div>
                        <div *ngSwitchCase="'amount'">
                          <ng-container *ngIf="data[template.matColumnDef] > 0">
                            {{ data[template.matColumnDef] | number: global.formatNumberToken }}
                            <span class="g-purple">{{ global.stableToken }}</span>
                          </ng-container>
                          <ng-container *ngIf="data[template.matColumnDef] == 0"> - </ng-container>
                        </div>
                        <div *ngSwitchDefault>{{ data[template.matColumnDef] }}</div>
                      </ng-container>
                    </div>
                  </td>
                </ng-container>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns" (click)="openTxsDetail($event, row)"></tr>
              <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell g-no-data" colspan="9999">
                  {{ 'NO DATA' | translate }}
                </td>
              </tr>
            </table>
          </ng-container>
          <ng-template #noValues>
            <app-table-no-data></app-table-no-data>
          </ng-template>
        </ngx-simplebar>

        <mat-paginator [length]="length" [pageIndex]="pageIndex" [pageSize]="pageSize" (page)="changePage($event)">
        </mat-paginator>
      </div>
    </div>
  </div>
</div>
