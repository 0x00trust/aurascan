<ng-container *ngIf="{ value: breakpoint$ | async } as breakpoint">
  <div class="card" *ngIf="proposalDetail">
    <div class="card-header bg-transparent border-bottom" *ngIf="!breakpoint.value.matches">
      <div class="d-flex justify-content-between">
        <div class="card__title">
          #{{ proposalId }} <br />
          <a class="card__title">{{ proposalDetail.pro_title }}</a>
        </div>
        <div class="card__status flex-shrink-0">
          <div class="message" *ngIf="proposalVotes">You voted '{{ proposalVotes }}' for this proposal</div>
          <button
            [disabled]="proposalDetail.pro_status != 'PROPOSAL_STATUS_VOTING_PERIOD'"
            (click)="openVoteDialog(proposalDetail)"
            class="button button-outline button-outline__in-card body flex-shrink-0">
            <span class="text-gradient">
              {{
                proposalDetail.pro_status != 'PROPOSAL_STATUS_VOTING_PERIOD' &&
                proposalDetail.pro_status != 'PROPOSAL_STATUS_DEPOSIT_PERIOD'
                  ? 'Voting Ended'
                  : 'Vote'
              }}
            </span>
          </button>
          <div class="proposal-status proposal-status__{{ getStatus(proposalDetail?.pro_status)?.key }}">
            <span>{{ getStatus(proposalDetail.pro_status)?.value }}</span>
          </div>
        </div>
      </div>
    </div>
    <div class="card-header bg-transparent pb-0" *ngIf="breakpoint.value.matches">
      <div class="d-flex justify-content-between mb-3">
        <div class="col-3 card__title card__title-mobile">#{{ proposalId }}</div>
        <div class="col-9 justify-content-end card__status flex-shrink-0">
          <button
            [disabled]="proposalDetail.pro_status != 'PROPOSAL_STATUS_VOTING_PERIOD'"
            (click)="openVoteDialog(proposalDetail)"
            class="button button-mobile button-outline button-outline__in-card body flex-shrink-0">
            <span class="text-gradient">
              {{
                proposalDetail.pro_status != 'PROPOSAL_STATUS_VOTING_PERIOD' &&
                proposalDetail.pro_status != 'PROPOSAL_STATUS_DEPOSIT_PERIOD'
                  ? 'Voting Ended'
                  : 'Vote'
              }}
            </span>
          </button>
          <div class="proposal-status-mobile proposal-status__{{ getStatus(proposalDetail?.pro_status)?.key }}">
            <span class="title-small-mobile">{{ getStatus(proposalDetail.pro_status)?.value }}</span>
          </div>
        </div>
      </div>
      <a class="card__title card__title-mobile">{{ proposalDetail.pro_title }}</a>
      <div class="message mt-2 text-end" *ngIf="proposalVotes">You voted '{{ proposalVotes }}' for this proposal</div>
      <div class="divider divider-horizontal mt-4"></div>
    </div>
    <div class="card-body">
      <div class="card__info">
        <div class="row mb-3 small-body">
          <div class="col-12 col-md-2 fw-semibold">Proposer</div>
          <div class="col-12 col-md-10 mt-2 mt-lg-0">
            <a class="text--primary" href="/account/{{ proposalDetail.pro_proposer_address }}">
              {{ proposalDetail.pro_proposer ? proposalDetail.pro_proposer : proposalDetail.pro_proposer_address }}
            </a>
          </div>
        </div>
        <div class="row mb-3 small-body">
          <div class="col-12 col-md-2 fw-semibold">Initial Deposit</div>
          <div class="col-12 col-md-10 mt-2 mt-lg-0">
            {{ proposalDetail.initial_deposit | number: global.formatNumberToken }}
            <span class="text--primary">{{ global.stableToken }}</span>
          </div>
        </div>
        <div class="row mb-3 small-body">
          <div class="col-12 col-md-2 fw-semibold">Total Deposit</div>
          <div class="col-12 col-md-10 mt-2 mt-lg-0">
            {{ proposalDetail.pro_total_deposits | number: global.formatNumberToken }}
            <span class="text--primary"> {{ global.stableToken }}</span>
          </div>
        </div>
        <div class="row mb-3 small-body">
          <div class="col-12 col-md-2 fw-semibold">Voting Start</div>
          <div class="col-12 col-md-10 mt-2 mt-lg-0">{{ proposalDetail.pro_voting_start_time }}</div>
        </div>
        <div class="row mb-3 small-body">
          <div class="col-12 col-md-2 fw-semibold">Voting End</div>
          <div class="col-12 col-md-10 mt-2 mt-lg-0">{{ proposalDetail.pro_voting_end_time }}</div>
        </div>
        <div class="row mb-3 small-body">
          <div class="col-12 col-md-2 fw-semibold">Type</div>
          <div class="col-12 col-md-10 mt-2 mt-lg-0">{{ proposalDetail.pro_type }}</div>
        </div>
        <div class="row mb-3 small-body">
          <div class="col-12 col-md-2 fw-semibold">Submit Time</div>
          <div class="col-12 col-md-10 mt-2 mt-lg-0">{{ proposalDetail.pro_submit_time }}</div>
        </div>
        <div class="row mb-3 small-body">
          <div class="col-12 col-md-2 fw-semibold">Deposit End Time</div>
          <div class="col-12 col-md-10 mt-2 mt-lg-0">{{ proposalDetail.pro_deposit_end_time }}</div>
        </div>
        <div class="row small-body">
          <div class="col-12 col-md-2 fw-semibold">Details</div>
          <div class="col-12 col-md-10 mt-2 mt-lg-0">{{ proposalDetail.pro_description }}</div>
        </div>
        <div class="divider divider-horizontal mt-4 mt-lg-5"></div>
      </div>
    </div>
    <div class="card-footer pt-0">
      <div
        class="proposal__summary-total"
        *ngIf="!votingBarLoading && proposalDetail.pro_status != 'PROPOSAL_STATUS_VOTING_PERIOD'">
        <div class="row mb-3 small-body">
          <div class="col-12 col-md-2 fw-semibold">Total:</div>
          <div class="col-12 col-md-10 mt-2 mt-lg-0">
            {{ proposalDetail.pro_total_vote | number: global.formatNumberToken }}
            <span class="text--primary">{{ global.stableToken }}</span>
          </div>
        </div>
        <div class="vote-bar" [class.vote-bar-mobile]="breakpoint.value.matches">
          <ul>
            <li
              class="bg--primary"
              [style.width]="proposalDetail.yesPercent + '%'"
              matTooltip="Yes {{ proposalDetail.yesPercent | number: global.formatNumber2Decimal }}%"
              [matTooltipPosition]="'above'"></li>
            <li
              class="bg--danger"
              [style.width]="proposalDetail.noPercent + '%'"
              matTooltip="No {{ proposalDetail.noPercent | number: global.formatNumber2Decimal }}%"
              [matTooltipPosition]="'above'"></li>
            <li
              class="bg--info"
              [style.width]="proposalDetail.noWithVetoPercent + '%'"
              matTooltip="No with veto {{
                proposalDetail.noWithVetoPercent | number: global.formatNumber2Decimal
              }}%"
              [matTooltipPosition]="'above'"></li>
            <li
              class="bg--secondary"
              [style.width]="proposalDetail.abstainPercent + '%'"
              matTooltip="Abstain {{ proposalDetail.abstainPercent | number: global.formatNumber2Decimal }}%"
              [matTooltipPosition]="'above'"></li>
          </ul>
        </div>
        <div class="vote-legend vote-legend-mobile" *ngIf="breakpoint.value.matches">
          <ul>
            <li data-style="primary">
              <div class="item-box">
                <span class="item item-label">Yes</span>
              </div>
              <span class="item item-percent">
                {{ this.proposalDetail.yesPercent | number: global.formatNumber2Decimal }}%
              </span>
              <p class="item item-amount">
                <span>{{ this.proposalDetail.pro_votes_yes || 0 | number: global.formatNumberToken }}</span>
                <span class="text--primary ml-1">{{ global.stableToken }}</span>
              </p>
            </li>
            <li data-style="danger">
              <div class="item-box">
                <span class="item item-label">No</span>
              </div>
              <span class="item item-percent">
                {{ this.proposalDetail.noPercent | number: global.formatNumber2Decimal }}%
              </span>
              <p class="item item-amount">
                <span>{{ this.proposalDetail.pro_votes_no || 0 | number: global.formatNumberToken }}</span>
                <span class="text--primary ml-1">{{ global.stableToken }}</span>
              </p>
            </li>
            <li data-style="info">
              <div class="item-box">
                <span class="item item-label">NoWithVeto</span>
              </div>
              <span class="item item-percent">
                {{ this.proposalDetail.noWithVetoPercent | number: global.formatNumber2Decimal }}%
              </span>
              <p class="item item-amount">
                <span>{{ this.proposalDetail.pro_votes_no_with_veto || 0 | number: global.formatNumberToken }}</span>
                <span class="text--primary ml-1">{{ global.stableToken }}</span>
              </p>
            </li>
            <li data-style="secondary">
              <div class="item-box">
                <span class="item item-label">Abstain</span>
              </div>
              <span class="item item-percent">
                {{ this.proposalDetail.abstainPercent | number: global.formatNumber2Decimal }}%
              </span>
              <p class="item item-amount">
                <span>{{ this.proposalDetail.pro_votes_abstain || 0 | number: global.formatNumberToken }}</span>
                <span class="text--primary ml-1">{{ global.stableToken }}</span>
              </p>
            </li>
          </ul>
        </div>
        <div class="vote-legend" *ngIf="!breakpoint.value.matches">
          <ul>
            <li data-style="primary">
              <div class="item-box">
                <span class="item item-label">Yes</span>
                <span class="item item-percent">
                  {{ this.proposalDetail.yesPercent | number: global.formatNumber2Decimal }}%
                </span>
              </div>
              <p class="item item-amount">
                <span>{{ this.proposalDetail.pro_votes_yes || 0 | number: global.formatNumberToken }}</span>
                <span class="text--primary ml-1">{{ global.stableToken }}</span>
              </p>
            </li>
            <li data-style="danger">
              <div class="item-box">
                <span class="item item-label">No</span>
                <span class="item item-percent">
                  {{ this.proposalDetail.noPercent | number: global.formatNumber2Decimal }}%
                </span>
              </div>
              <p class="item item-amount">
                <span>{{ this.proposalDetail.pro_votes_no || 0 | number: global.formatNumberToken }}</span>
                <span class="text--primary ml-1">{{ global.stableToken }}</span>
              </p>
            </li>
            <li data-style="info">
              <div class="item-box">
                <span class="item item-label">NoWithVeto</span>
                <span class="item item-percent">
                  {{ this.proposalDetail.noWithVetoPercent | number: global.formatNumber2Decimal }}%
                </span>
              </div>
              <p class="item item-amount">
                <span>{{ this.proposalDetail.pro_votes_no_with_veto || 0 | number: global.formatNumberToken }}</span>
                <span class="text--primary ml-1">{{ global.stableToken }}</span>
              </p>
            </li>
            <li data-style="secondary">
              <div class="item-box">
                <span class="item item-label">Abstain</span>
                <span class="item item-percent">
                  {{ this.proposalDetail.abstainPercent | number: global.formatNumber2Decimal }}%
                </span>
              </div>
              <p class="item item-amount">
                <span>{{ this.proposalDetail.pro_votes_abstain || 0 | number: global.formatNumberToken }}</span>
                <span class="text--primary ml-1">{{ global.stableToken }}</span>
              </p>
            </li>
          </ul>
        </div>
      </div>
      <ng-container *ngIf="true">
        <div class="row proposal__summary-total">
          <div class="col-12 col-lg-6 pr-lg-8 border-right">
            <div class="d-lg-flex justify-content-between">
              <div class="title-small fw-semibold text--white">
                Current Turnout: {{ proposalDetail.pro_turnout | number: global.formatNumber2Decimal }}%
              </div>
              <div class="body text--light-gray">
                ({{ formatNumber(proposalDetail.pro_total_vote) || 0}} of {{ formatNumber(proposalDetail.total_bonded_token) }} has voted)
              </div>
            </div>
            <div class="mt-2 small-body text--white content--fixed-height">
              The result of governance will only be applied when quorum is more than
              {{ proposalDetail.quorum | number: global.formatNumber2Decimal }}% of the total votes.
            </div>
            <div class="vote-bar mt-20 mb-4">
              <ul>
                <li class="bg--info" [style.width]="proposalDetail.pro_turnout + '%'"></li>
              </ul>
              <div class="vote-bar__info" [style.left]="proposalDetail.quorum + '%'">
                <span class="fw-semibold">
                  Quorum: {{ proposalDetail.quorum | number: global.formatNumber2Decimal }}%
                </span>
                <span class="text--green ml-1" *ngIf="isNotReached">(Not Reached)</span>
              </div>
            </div>
            <div class="row">
              <div class="col-5 fw-semibold">Voted</div>
              <div class="col-3 fw-semibold">
                {{ proposalDetail.voted_percent | number: global.formatNumber2Decimal }}%
              </div>
              <div class="col-4 text-end">{{ proposalDetail.voted | number: global.formatNumberToken }}</div>
            </div>
            <div class="row mt-2">
              <div class="col-5 fw-semibold">Voted Abstain</div>
              <div class="col-3 fw-semibold">
                {{ proposalDetail.abstainPercent | number: global.formatNumber2Decimal }}%
              </div>
              <div class="col-4 text-end">
                {{ proposalDetail.pro_votes_abstain | number: global.formatNumberToken }}
              </div>
            </div>
            <div class="row mt-2">
              <div class="col-5 fw-semibold">Did not vote</div>
              <div class="col-3 fw-semibold">{{ 100 - proposalDetail.pro_turnout }}%</div>
              <div class="col-4 text-end">{{ proposalDetail.total_bonded_token - proposalDetail.voted }}</div>
            </div>
          </div>
          <div class="col-12 col-lg-6 pl-lg-8">
            <div class="title-small fw-semibold text--white">
              Current Status:
              <span class="text--green" [class.text--danger]="currentStatus === 'Reject'">{{ currentStatus }}</span>
            </div>
            <div class="mt-2 small-body text--white content--fixed-height">{{ this.currentSubTitle }}</div>
            <div class="vote-bar mt-20 mb-4">
              <ul>
                <li class="bg--primary" [style.width]="proposalDetail.yesPercent + '%'"></li>
                <li class="bg--danger" [style.width]="proposalDetail.noPercent + '%'"></li>
                <li class="bg--secondary" [style.width]="proposalDetail.noWithVetoPercent + '%'"></li>
              </ul>
              <div class="vote-bar__info" [style.left]="proposalDetail.threshold + '%'">
                <span class="fw-semibold">
                  Threshold: {{ proposalDetail.threshold | number: global.formatNumber2Decimal }}%
                </span>
              </div>
            </div>
            <div class="row">
              <div class="col-5 fw-semibold">
                <span class="vote-status vote-status--primary ml-8">Yes</span>
              </div>
              <div class="col-3 fw-semibold">
                {{ proposalDetail.yesPercent | number: global.formatNumber2Decimal }}%
              </div>
              <div class="col-4 text-end">{{ proposalDetail.pro_votes_yes | number: global.formatNumberToken }}</div>
            </div>
            <div class="row mt-2">
              <div class="col-5 fw-semibold">
                <span class="vote-status vote-status--danger ml-8">No</span>
              </div>
              <div class="col-3 fw-semibold">{{ proposalDetail.noPercent | number: global.formatNumber2Decimal }}%</div>
              <div class="col-4 text-end">{{ proposalDetail.pro_votes_no | number: global.formatNumberToken }}</div>
            </div>
            <div class="row mt-2">
              <div class="col-5 fw-semibold">
                <span class="vote-status vote-status--secondary ml-8">NoWithVeto</span>
              </div>
              <div class="col-3 fw-semibold">
                {{ proposalDetail.noWithVetoPercent | number: global.formatNumber2Decimal }}%
              </div>
              <div class="col-4 text-end">
                {{ proposalDetail.pro_votes_no_with_veto | number: global.formatNumberToken }}
              </div>
            </div>
          </div>
        </div>
      </ng-container>

      <div *ngIf="votingBarLoading" class="">
        <app-loading-sprint></app-loading-sprint>
      </div>
    </div>
  </div>
</ng-container>
