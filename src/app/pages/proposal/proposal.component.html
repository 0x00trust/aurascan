<ng-container *ngIf="{ value: breakpoint$ | async } as breakpoint">
  <section class="lasted-list" *ngIf="lastedList && lastedList.length > 0">
    <app-pagetitle title="Votings"></app-pagetitle>
    <div class="row row-eq-height">
      <ng-container *ngIf="!breakpoint.value.matches">
        <div class="col-6 proposal-lasted" *ngFor="let lastedItem of lastedList.slice(0, 4); index as idx">
          <div class="card mb-0 h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start">
                <div class="card__title title-small text--green">
                  #{{ lastedItem.pro_id }} <br />
                  <a [routerLink]="[lastedItem.pro_id]" class="card__title text--green text-clamp">
                    {{ lastedItem.pro_title }}
                  </a>
                </div>
                <div
                  *ngIf="getStatus(lastedItem.pro_status)"
                  class="proposal-status flex-shrink-0 proposal-status__{{ getStatus(lastedItem.pro_status).key }}">
                  <span>{{ getStatus(lastedItem.pro_status).value }}</span>
                </div>
              </div>
              <div class="d-flex justify-content-between mt-6 proposal-lasted__content small-body">
                <div>
                  <div class="d-flex mb-2">
                    <div class="content-body">Proposer</div>
                    <a href="/account/{{ lastedItem.pro_proposer_address }}" class="text--green content-body">
                      {{
                        lastedItem.pro_proposer
                          ? lastedItem.pro_proposer
                          : (lastedItem.pro_proposer_address | cutStringPipe: 8:8)
                      }}</a
                    >
                  </div>
                  <div class="d-flex mb-2">
                    <div class="content-body">Voting Start</div>
                    <div class="content-body">{{ lastedItem.pro_voting_start_time | mask: '0000-00-00 00:00:00' }}</div>
                  </div>
                  <div class="d-flex mb-2">
                    <div class="content-body">Voting End</div>
                    <div class="content-body">{{ lastedItem.pro_voting_end_time | mask: '0000-00-00 00:00:00' }}</div>
                  </div>
                </div>
              </div>
              <div class="mt-3 d-flex">
                <div class="vote-bar flex-grow-1">
                  <ul>
                    <li
                      class="primary"
                      [style.width]="lastedItem.pro_votes_yes + '%'"
                      matTooltip="Yes {{ lastedItem.pro_votes_yes | number: global.formatNumber2Decimal }}%"
                      [matTooltipPosition]="'above'"></li>
                    <li
                      class="danger"
                      *ngIf="lastedItem.pro_votes_no"
                      [style.width]="lastedItem.pro_votes_no + '%'"
                      matTooltip="No {{ lastedItem.pro_votes_no | number: global.formatNumber2Decimal }}%"
                      [matTooltipPosition]="'above'"></li>
                    <li
                      class="info"
                      *ngIf="lastedItem.pro_votes_no_with_veto"
                      [style.width]="lastedItem.pro_votes_no_with_veto + '%'"
                      matTooltip="No with veto {{
                        lastedItem.pro_votes_no_with_veto | number: global.formatNumber2Decimal
                      }}%"
                      [matTooltipPosition]="'above'"></li>
                    <li
                      class="secondary"
                      *ngIf="lastedItem.pro_votes_abstain"
                      [style.width]="lastedItem.pro_votes_abstain + '%'"
                      matTooltip="Abstain {{ lastedItem.pro_votes_abstain | number: global.formatNumber2Decimal }}%"
                      [matTooltipPosition]="'above'"></li>
                  </ul>
                </div>
                <div class="most-vote flex-shrink-0">
                  <div class="small-body mb-2">Most voted on</div>
                  <div
                    class="value {{
                      getHighestVote(
                        lastedItem.pro_votes_yes,
                        lastedItem.pro_votes_no,
                        lastedItem.pro_votes_no_with_veto,
                        lastedItem.pro_votes_abstain
                      ).class
                    }}">
                    {{
                      getHighestVote(
                        lastedItem.pro_votes_yes,
                        lastedItem.pro_votes_no,
                        lastedItem.pro_votes_no_with_veto,
                        lastedItem.pro_votes_abstain
                      ).name
                    }}&nbsp;
                    {{
                      getHighestVote(
                        lastedItem.pro_votes_yes,
                        lastedItem.pro_votes_no,
                        lastedItem.pro_votes_no_with_veto,
                        lastedItem.pro_votes_abstain
                      ).value | number: global.formatNumber2Decimal
                    }}%
                  </div>
                </div>
              </div>
            </div>
            <div class="card-footer">
              <div class="top-border">
                <div class="d-flex justify-content-end align-items-center">
                  <div class="message mr-5" *ngIf="lastedItem.vote_option">
                    You voted "{{ lastedItem.vote_option }}" for this proposal
                  </div>
                  <button class="btn button-inline body text--green mr-3" [routerLink]="[lastedItem.pro_id]">
                    Details
                  </button>
                  <button
                    [disabled]="lastedItem.pro_status != 'PROPOSAL_STATUS_VOTING_PERIOD'"
                    (click)="openVoteDialog(lastedItem, idx)"
                    class="button button-outline button-outline__in-card body">
                    <span class="text-gradient">
                      {{
                        lastedItem.pro_status != 'PROPOSAL_STATUS_VOTING_PERIOD' &&
                        lastedItem.pro_status != 'PROPOSAL_STATUS_DEPOSIT_PERIOD'
                          ? 'Voting Ended'
                          : 'Vote'
                      }}
                    </span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </ng-container>
      <ng-container *ngIf="breakpoint.value.matches">
        <div class="proposal-lasted" *ngFor="let lastedItem of lastedList; index as idex">
          <div class="card mb-0 h-100">
            <div class="card-body">
              <div class="justify-content-between align-items-start border-bottom-mobile">
                <div class="card__title-mobile mb-3 text--green text-clamp" [routerLink]="[lastedItem.pro_id]">
                  #{{ lastedItem.pro_id }} {{ lastedItem.pro_title }}
                </div>
                <div class="message mb-3 text-end" *ngIf="lastedItem.vote_option">
                  You voted "{{ lastedItem.vote_option }}" for this proposal
                </div>
              </div>
              <div class="d-flex justify-content-between mt-3 proposal-lasted__content">
                <div class="w-100">
                  <div class="d-flex justify-content-between align-items-end mb-3">
                    <div class="small-body"><span>Status</span></div>
                    <div
                      *ngIf="getStatus(lastedItem.pro_status)"
                      class="proposal-status-mobile flex-shrink-0 fw-semibold proposal-status__{{
                        getStatus(lastedItem.pro_status).key
                      }}">
                      <span class="status">{{ getStatus(lastedItem.pro_status).value }}</span>
                    </div>
                  </div>
                  <div class="d-flex justify-content-between mb-3 small-body body-mobile">
                    <div>Voting Start</div>
                    <div>
                      {{ lastedItem.pro_voting_start_time | mask: '0000-00-00 00:00:00' }}
                    </div>
                  </div>
                  <div class="d-flex justify-content-between small-body body-mobile">
                    <div>Voting End</div>
                    <div>
                      {{ lastedItem.pro_voting_end_time | mask: '0000-00-00 00:00:00' }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="card-footer card-footer-mobile d-flex justify-content-around">
              <button class="btn button-inline body text--green col-6" [routerLink]="[lastedItem.pro_id]">
                Details
              </button>
              <button
                [disabled]="lastedItem.pro_status != 'PROPOSAL_STATUS_VOTING_PERIOD'"
                (click)="openVoteDialog(lastedItem, idex)"
                class="button button-mobile button-outline button-outline__in-card body col-6">
                <span class="text-gradient">
                  {{
                    lastedItem.pro_status != 'PROPOSAL_STATUS_VOTING_PERIOD' &&
                    lastedItem.pro_status != 'PROPOSAL_STATUS_DEPOSIT_PERIOD'
                      ? 'Voting Ended'
                      : 'Vote'
                  }}
                </span>
              </button>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </section>
  <section class="all-list table-responsive" *ngIf="!breakpoint.value.matches">
    <div class="card" *ngIf="dataSource?.data?.length > 0">
      <div class="card-header card-header-dark align-items-center d-flex justify-content-between">
        <div class="sub-text text--white">Votings</div>
        <!-- <button type="button" class="button button-outline" [routerLink]="'/transaction'">View more</button> -->
      </div>
      <div class="card-body pt-0">
        <table mat-table [dataSource]="dataSource" matSort class="table-reponsive aura-table">
          <!-- ID Column -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef>#ID</th>
            <td mat-cell *matCellDef="let element">#{{ element.pro_id }}</td>
          </ng-container>

          <!-- Title Column -->
          <ng-container matColumnDef="title">
            <th mat-header-cell *matHeaderCellDef>Title</th>
            <td mat-cell *matCellDef="let element" class="title-cell">
              <a [routerLink]="[element.pro_id]" class="text-clamp">{{ element.pro_title }}</a>
            </td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let element">
              <div
                class="aura-status {{ getStatus(element.pro_status).class }} text-uppercase"
                *ngIf="getStatus(element.pro_status)">
                <span class="status">{{ getStatus(element.pro_status).value }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Voting Start Column -->
          <ng-container matColumnDef="votingStart">
            <th mat-header-cell *matHeaderCellDef>Voting Start</th>
            <td mat-cell *matCellDef="let element">{{ element.pro_voting_start_time }}</td>
          </ng-container>

          <!-- Submit Time Column -->
          <ng-container matColumnDef="submitTime">
            <th mat-header-cell *matHeaderCellDef>Submit Time</th>
            <td mat-cell *matCellDef="let element">{{ element.pro_submit_time }}</td>
          </ng-container>

          <!-- Total Deposit Column -->
          <ng-container matColumnDef="totalDeposit">
            <th mat-header-cell *matHeaderCellDef>Total Deposit</th>
            <td mat-cell *matCellDef="let element">
              {{ element.pro_total_deposits | number: global.formatNumberToken }}
              <span class="text--primary">{{ global.stableToken }}</span>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell g-no-data" colspan="9999">
              {{ 'NO DATA' | translate }}
            </td>
          </tr>
        </table>
      </div>
    </div>
    <div *ngIf="!(dataSource?.data?.length > 0)">
      <app-table-no-data></app-table-no-data>
    </div>
  </section>
</ng-container>
