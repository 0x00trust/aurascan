<app-pagetitle title="PROPOSAL" [breadcrumbItems]="breadCrumbItems"></app-pagetitle>
<section class="lasted-list" *ngIf="lastedList.length > 0">
    <div class="container-fluid">
        <div class="row">
            <div class="col-6 mb-3 proposal-lasted" *ngFor="let lastedItem of lastedList">
                <mat-card>
                    <div class="d-flex justify-content-between mb-2">
                        <div class="card__title">#{{lastedItem.id}}</div>
                        <div *ngIf="getStatus(lastedItem.status)"
                                class="proposal-status proposal-status--has-elevation text-uppercase {{getStatus(lastedItem.status).class}}">
                            <span class="status">{{getStatus(lastedItem.status).value}}</span>
                        </div>
                    </div>
                    <a [routerLink]="['id', lastedItem.id]" class="card__title">{{lastedItem.title}}</a>
                    <div class="d-flex justify-content-between mt-3 proposal-lasted__content">
                        <div>
                            <div class="d-flex mb-2">
                                <div class="title">Proposer</div>
                                <div><a href="#">{{ lastedItem.proposer }}</a></div>
                            </div>
                            <div class="d-flex mb-2">
                                <div class="title">Voting Start</div>
                                <div>{{ lastedItem.votingStart }}</div>
                            </div>
                            <div class="d-flex mb-2">
                                <div class="title">Voting End</div>
                                <div>{{ lastedItem.votingEnd }}</div>
                            </div>
                        </div>
                        <a href="#" class="button button-circle">
                            <mat-icon>keyboard_arrow_right</mat-icon>
                        </a>
                    </div>
                    <div class="mt-3 d-flex">
                        <div class="vote-bar">
                            <ul *ngIf="lastedItem.voteResult">
                                <li class="primary"
                                    *ngIf="lastedItem.voteResult.yes"
                                    style="width: {{lastedItem.voteResult.yes}}%"
                                    matTooltip="Yes {{lastedItem.voteResult.yes}}%"
                                    [matTooltipPosition]="'above'"
                                ></li>
                                <li class="danger"
                                    *ngIf="lastedItem.voteResult.no"
                                    style="width: {{lastedItem.voteResult.no}}%"
                                    matTooltip="No {{lastedItem.voteResult.no}}%"
                                    [matTooltipPosition]="'above'"
                                ></li>
                                <li class="info"
                                    *ngIf="lastedItem.voteResult.noWithVeto"
                                    style="width: {{lastedItem.voteResult.noWithVeto}}%"
                                    matTooltip="No with veto {{lastedItem.voteResult.noWithVeto}}%"
                                    [matTooltipPosition]="'above'"
                                ></li>
                                <li class="secondary"
                                    *ngIf="lastedItem.voteResult.abstain"
                                    style="width: {{lastedItem.voteResult.abstain}}%"
                                    matTooltip="Abstain {{lastedItem.voteResult.abstain}}%"
                                    [matTooltipPosition]="'above'"
                                ></li>
                            </ul>
                        </div>
                        <mat-divider [vertical]="true"></mat-divider>
                        <div class="most-vote">
                            <div class="title">Most voted on</div>
                            <div class="value" [ngClass]="{
                                 'primary': filterGetHighestVote(lastedItem.voteResult)[0] === 'yes',
                                 'danger': filterGetHighestVote(lastedItem.voteResult)[0] === 'no',
                                 'info': filterGetHighestVote(lastedItem.voteResult)[0] === 'noWithVeto',
                                 'secondary': filterGetHighestVote(lastedItem.voteResult)[0] === 'abstain'
                            }">
                                {{ 'PAGES.PROPOSAL.'+ filterGetHighestVote(lastedItem.voteResult)[0] | translate }}&nbsp;
                                {{filterGetHighestVote(lastedItem.voteResult)[1]}}%
                            </div>
                        </div>
                    </div>
                    <div *ngIf="voteAvailable" class="pt-3">
                        <mat-divider></mat-divider>
                        <div class="d-flex justify-content-end mt-3 align-items-center">
                            <div class="message" *ngIf="lastedItem.currentVote != ''">You vote '{{ lastedItem.currentVote }}' for this proposal</div>
                            <a class="btn-detail" href="#" mat-stroked-button color="primary">Details</a>
                            <button mat-flat-button color="primary" [disabled]="lastedItem.status != 2" (click)="openVoteDialog(lastedItem.id, lastedItem.title)">
                                {{lastedItem.status != 2 ? 'Voting Ended' : 'Vote'}}</button>
                        </div>
                    </div>
                </mat-card>
            </div>
        </div>
    </div>
</section>
<section class="all-list" *ngIf="dataSource">
    <table mat-table [dataSource]="dataSource" class="table-responsive" matSort>
        <!-- ID Column -->
        <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>#ID</th>
            <td mat-cell *matCellDef="let element">#{{element.id}}</td>
        </ng-container>

        <!-- Title Column -->
        <ng-container matColumnDef="title">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Title</th>
            <td mat-cell *matCellDef="let element">
                <a [routerLink]="['id', element.id]">{{element.title}}</a>
            </td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
            <td mat-cell *matCellDef="let element">
                <div class="proposal-status {{getStatus(element.status).class}} text-uppercase" *ngIf="getStatus(element.status)">
                    <span class="status">{{getStatus(element.status).value}}</span>
                </div>
            </td>
        </ng-container>

        <!-- Voting Start Column -->
        <ng-container matColumnDef="votingStart">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Voting Start</th>
            <td mat-cell *matCellDef="let element">{{element.votingStart}}</td>
        </ng-container>

        <!-- Submit Time Column -->
        <ng-container matColumnDef="submitTime">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Submit Time</th>
            <td mat-cell *matCellDef="let element">{{element.submitTime}}</td>
        </ng-container>

        <!-- Total Deposit Column -->
        <ng-container matColumnDef="totalDeposit">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Total Deposit</th>
            <td mat-cell *matCellDef="let element">{{element.totalDeposit}}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell g-no-data" colspan="9999">
                {{"NO DATA" | translate}}
            </td>
        </tr>
    </table>
</section>
